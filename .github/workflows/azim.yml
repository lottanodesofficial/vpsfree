name: VPS 24/7

on:
  workflow_dispatch:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 43200  # 30 days (max GitHub limit)

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run VPS (24/7 with SSHX)
        run: |
          sudo apt update -y
          sudo apt install -y curl jq

          echo "ğŸš€ Starting SSHX VPS in non-interactive mode..."

          # Run SSHx silently in background and log output
          (curl -sSf https://sshx.io/get | sh -s -- -n) > sshx.log 2>&1 &

          # Wait for link generation
          sleep 5

          # Extract SSH link from log file
          LINK=$(grep -Eo 'https://sshx\.io/[a-zA-Z0-9]+' sshx.log | head -n 1)

          if [ -z "$LINK" ]; then
            echo "âŒ SSHX link not found! Dumping full log:"
            cat sshx.log
            exit 1
          fi

          echo "âœ… VPS started successfully!"
          for i in {1..10}; do
            echo "ğŸ”— SSHX Link #$i: $LINK"
            sleep 2
          done

          echo "ğŸ’¡ Keep this workflow running to keep VPS alive."

          # Keep the VPS alive indefinitely
          while true; do
            echo "ğŸŸ¢ VPS heartbeat â€” still alive..."
            sleep 300
          done
