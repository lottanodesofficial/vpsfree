name: VPS 24/7

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 43200  # 30 days max (GitHub limit)

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run VPS (24/7 with SSHX)
        run: |
          # Install dependencies
          sudo apt update -y
          sudo apt install -y curl jq

          echo "Starting SSHX VPS..."

          # Run SSHx in the background and capture output
          nohup bash -c "curl -sSf https://sshx.io/get | sh" > sshx.log 2>&1 &

          # Wait a few seconds for link generation
          sleep 5

          # Extract SSH link from log (if available)
          LINK=$(grep -Eo 'https://sshx\.io/[a-zA-Z0-9]+' sshx.log | head -n 1 || true)

          if [ -z "$LINK" ]; then
            echo "‚ùå Failed to get SSHX link!"
            echo "Here‚Äôs the log output:"
            cat sshx.log
            exit 1
          fi

          # Show link 10 times
          for i in {1..10}; do
            echo "üîó SSHX Link #$i: $LINK"
            sleep 2
          done

          echo "‚úÖ VPS is running 24/7. Do NOT close this workflow."

          # Keep VPS alive
          while true; do
            echo "üí§ VPS heartbeat ‚Äî still active..."
            sleep 300
          done
